stages:
    - build
    - d-build

maven-build:
    stage: build
    image: maven:latest
    script:
        - export DATABASE_URI=$DATABASE_URI
        - export DBUSER=$DBUSER
        - export DBPASSWORD=$DBPASSWORD
        - mvn clean compile
        - mvn package -DskipTests=true
    artifacts:
        paths:
            - target/*.jar

docker-build:
    stage: d-build
    image: docker:latest
    services:
        - docker:dind
    script:
        - docker login -u $DOCKERHUB_USERNAME -p $DOCKERHUB_PASSWORD
        - docker build -t $DOCKERHUB_USERNAME/$DOCKERHUB_IMAGE .
        - docker push $DOCKERHUB_USERNAME/$DOCKERHUB_IMAGE
        - docker logout